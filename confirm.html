<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AW Collision — Expense Confirmation</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#020617;
  --card:#ffffff;
  --text:#020617;
  --muted:#6b7280;
  --border:#e5e7eb;

  --approve:#16a34a;
  --reject:#dc2626;
  --initial:#f59e0b;

  --radius:16px;
  --shadow:0 30px 80px rgba(0,0,0,.25);
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,Arial,sans-serif;
  background:linear-gradient(180deg,#020617,#0f172a);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:32px;
}

.card{
  width:100%;
  max-width:620px;
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  overflow:hidden;
}

.header{
  padding:22px 28px;
  background:linear-gradient(90deg,#020617,#7f1d1d);
  color:#fff;
  font-weight:800;
}

.body{
  padding:34px;
  color:var(--text);
}

.notice{
  background:#fff7ed;
  color:#92400e;
  padding:16px;
  border-radius:12px;
  font-weight:600;
  margin-bottom:22px;
}

.table{
  width:100%;
  border-collapse:collapse;
  margin-bottom:28px;
}

.table td{
  padding:12px 0;
  border-bottom:1px solid var(--border);
  font-size:14px;
}

.table td:first-child{
  font-weight:700;
  color:#374151;
  width:45%;
}

.actions{
  display:flex;
  flex-direction:column;
  gap:14px;
}

button{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:800;
  cursor:pointer;
  color:#fff;
  transition:.2s ease;
}

button:disabled{
  opacity:.7;
  cursor:not-allowed;
}

.initial{background:linear-gradient(135deg,#fbbf24,#b45309)}
.approve{background:linear-gradient(135deg,#16a34a,#15803d)}
.reject{background:linear-gradient(135deg,#dc2626,#991b1b)}

.success{
  display:none;
  margin-top:22px;
  padding:18px;
  border-radius:14px;
  background:#ecfdf5;
  color:#065f46;
  font-weight:800;
  text-align:center;
}
</style>
</head>

<body>

<div class="card">
  <div class="header">AW Collision — Expense Confirmation</div>

  <div class="body">

    <div class="notice">
      Please review the expense details and choose an action below.
    </div>

    <table class="table">
      <tr>
        <td>Employee Name</td>
        <td id="empName"></td>
      </tr>
      <tr>
        <td>Expense Amount</td>
        <td>$<span id="amount"></span></td>
      </tr>
      <tr>
        <td>Expense ID</td>
        <td id="expenseId"></td>
      </tr>
      <tr>
        <td>Selected Action</td>
        <td id="actionText"></td>
      </tr>
    </table>

    <div class="actions">
      <button id="initialBtn" class="initial">Initial Approve</button>
      <button id="approveBtn" class="approve">Approve</button>
      <button id="rejectBtn" class="reject">Reject</button>
    </div>

    <div class="success" id="successMsg">
      ✅ Action confirmed successfully.
    </div>

  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);

const expenseId = params.get("expense_id");
const token = params.get("token");
const name = params.get("name") || "";
const amount = params.get("amount") || "";
const selectedAction = params.get("selected_action") || "—";

const approveWebhook = params.get("approveWebhook");
const rejectWebhook = params.get("rejectWebhook");
const initialWebhook = params.get("initialWebhook");

document.getElementById("empName").innerText = name;
document.getElementById("amount").innerText = amount;
document.getElementById("expenseId").innerText = expenseId;
document.getElementById("actionText").innerText = selectedAction.toUpperCase();

async function sendAction(action, webhook) {
  if (!webhook) {
    alert("Webhook not configured.");
    return;
  }

  disableButtons();

  try {
    const res = await fetch("/.netlify/functions/forward", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        webhook,
        payload: {
          expense_id: expenseId,
          action,
          token,
          name,
          amount
        }
      })
    });

    if (!res.ok) throw new Error("Forward failed");

    document.getElementById("successMsg").style.display = "block";
  } catch (err) {
    alert("Something went wrong. Please try again.");
    console.error(err);
  }
}

function disableButtons(){
  document.getElementById("initialBtn").disabled = true;
  document.getElementById("approveBtn").disabled = true;
  document.getElementById("rejectBtn").disabled = true;
}

document.getElementById("initialBtn").onclick = () =>
  sendAction("InitialApprove", initialWebhook);

document.getElementById("approveBtn").onclick = () =>
  sendAction("Approve", approveWebhook);

document.getElementById("rejectBtn").onclick = () =>
  sendAction("Reject", rejectWebhook);
</script>

</body>
</html>
